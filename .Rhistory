seaorland = "maritime"))
# Convert sunrise time to POSIXct
ccc$sunrise2 <- as.POSIXct(paste(date(ccc$start_time), " ", floor(ccc$sunrise), ":", floor(ccc$sunrise%%1 * 60), ":", floor((ccc$sunrise%%1 * 60)%%1*60), sep = ""), tz = "America/Anchorage")
head(ccc)
# Plot sunrise times over light meaurements.
ggplot() + geom_path(data = bbb, aes(x = datetime, y = clight)) +
geom_vline(data = ccc, aes(xintercept = sunrise2), col = "red", linetype = 2)
ggplot() + geom_path(data = subset(bbb, month(datetime) <= 7 & day(datetime) < 15), aes(x = datetime, y = clight)) +
geom_vline(data = subset(ccc, month(sunrise2) <= 7 & day(sunrise2) < 15), aes(xintercept = sunrise2), col = "red", linetype = 2)
ggplot() + geom_path(data = subset(bbb, month(datetime) >= 7 & day(datetime) < 15), aes(x = datetime, y = clight)) +
geom_vline(data = subset(ccc, month(sunrise2) >= 7 & day(sunrise2) < 15), aes(xintercept = sunrise2), col = "red", linetype = 2)
ggplot() + geom_path(data = subset(bbb, month(datetime) == 7 & day(datetime) < 15), aes(x = datetime, y = clight)) +
geom_vline(data = subset(ccc, month(sunrise2) == 7 & day(sunrise2) < 15), aes(xintercept = sunrise2), col = "red", linetype = 2)
ggplot() + geom_path(data = subset(bbb, month(datetime) >= 7 & day(datetime) > 5), aes(x = datetime - 12 * 3600, y = clight)) +
geom_vline(data = subset(ccc, month(sunrise2) >= 7 & day(sunrise2) > 5), aes(xintercept = sunrise2), col = "red", linetype = 2)
light.dir[5]
paste0(light.dir[5], "\\deck1_0490940.csv")
getwd
getwd()
dir("..")
getwd()
knit_with_parameters('C:/Users/seanr/OneDrive/afsc/Light data processing/TLUtilities/vignettes/surface_errors.Rmd')
?knitr
dir()
setwd("C:/Users/seanr/OneDrive/afsc/Light data processing/TLUtilities")
dir()
knit(input = "./vignettes/surface_errors.Rmd", output = "./vignettes/surface_errors.md")
knitr::knit(input = "./vignettes/surface_errors.Rmd", output = "./vignettes/surface_errors.md")
getwd()
knitr::knit(input = "./vignettes/surface_errors.Rmd", output = "./vignettes/surface_errors.md")
knitr::knit(input = "./vignettes/surface_errors.Rmd", output = "./vignettes/surface_errors.md")
?knit
knitr::knit(input = "./vignettes/surface_errors.Rmd", output = "./vignettes/surface_errors.md")
getwd()
setwd("../testing_space/")
dir()
light.dir
light.dir[22]
dir(light.dir[22])
bbb <- read.csv(file = paste0(light.dir[22], "\\deck1_0990424.csv"), header = F)
head(bbb)
names(bbb) <- c("date", "time", "cdepth", "temp", "clight")
bbb$datetime <- paste(bbb$date, bbb$time)
bbb$datetime <- as.POSIXct(bbb$datetime, format = "%m/%d/%Y %H:%M:%S", tz = "America/Anchorage")
ggplot(data = bbb, aes(x = datetime, y = clight)) + geom_path()
# Using astrocalc4r, I find the sunrise time for the latitude and longitude for the first haul of every day.
ccc <- subset(haul_time_position, vessel == 94 & cruise == 201401)
ccc <- subset(ccc, haul %in% aggregate(haul ~ yday(ccc$start_time), data = ccc, FUN = min)[,2])
ccc <- cbind(ccc,
astrocalc4r(day = day(ccc$start_time),
month = month(ccc$start_time),
year = year(ccc$start_time),
hour = hour(ccc$start_time) + minute(ccc$start_time)/60,
timezone = rep(-8, nrow(ccc)),
lat = ccc$start_latitude,
lon = ccc$start_longitude,
seaorland = "maritime"))
ccc$sunrise2 <- as.POSIXct(paste(date(ccc$start_time), " ", floor(ccc$sunrise), ":", floor(ccc$sunrise%%1 * 60), ":", floor((ccc$sunrise%%1 * 60)%%1*60), sep = ""), tz = "America/Anchorage")
ggplot() + geom_path(data = bbb, aes(x = datetime, y = clight)) +
geom_vline(data = ccc, aes(xintercept = sunrise2), col = "red", linetype = 2)
ggplot() + geom_path(data = subset(bbb, month(datetime) < 7), aes(x = datetime, y = clight)) +
geom_vline(data = subset(ccc, month(datetime) < 7), aes(xintercept = sunrise2), col = "red", linetype = 2)
ggplot() + geom_path(data = subset(bbb, month(datetime) < 7), aes(x = datetime, y = clight)) +
geom_vline(data = subset(ccc, month(sunrise2) < 7), aes(xintercept = sunrise2), col = "red", linetype = 2)
light.dir[22]
light.dir
dir(light.dir[21])
head(ccc)
dir(light.dir[21])
#bbb <- read.csv(file = paste0(light.dir[22], "\\deck1_0990424.csv"), header = F)
bbb <- read.csv(file = paste0(light.dir[21], "\\deck1_1190403.csv"), header = F)
head(bbb)
names(bbb) <- c("date", "time", "cdepth", "temp", "clight")
bbb$datetime <- paste(bbb$date, bbb$time)
bbb$datetime <- as.POSIXct(bbb$datetime, format = "%m/%d/%Y %H:%M:%S", tz = "America/Anchorage")
ggplot(data = bbb, aes(x = datetime, y = clight)) + geom_path()
# Using astrocalc4r, I find the sunrise time for the latitude and longitude for the first haul of every day.
#ccc <- subset(haul_time_position, vessel == 94 & cruise == 201401)
ccc <- subset(haul_time_position, vessel == 162 & cruise == 201401)
ccc <- subset(ccc, haul %in% aggregate(haul ~ yday(ccc$start_time), data = ccc, FUN = min)[,2])
ccc <- cbind(ccc,
astrocalc4r(day = day(ccc$start_time),
month = month(ccc$start_time),
year = year(ccc$start_time),
hour = hour(ccc$start_time) + minute(ccc$start_time)/60,
timezone = rep(-8, nrow(ccc)),
lat = ccc$start_latitude,
lon = ccc$start_longitude,
seaorland = "maritime"))
ccc$sunrise2 <- as.POSIXct(paste(date(ccc$start_time), " ", floor(ccc$sunrise), ":", floor(ccc$sunrise%%1 * 60), ":", floor((ccc$sunrise%%1 * 60)%%1*60), sep = ""), tz = "America/Anchorage")
ggplot() + geom_path(data = subset(bbb, month(datetime) < 7), aes(x = datetime, y = clight)) +
geom_vline(data = subset(ccc, month(sunrise2) < 7), aes(xintercept = sunrise2), col = "red", linetype = 2)
mean(hour(ccc$start_time))
ggplot() + geom_path(data = subset(bbb, month(datetime) < 7), aes(x = datetime, y = clight)) +
geom_vline(data = subset(ccc, month(sunrise2) < 7), aes(xintercept = sunrise2), col = "red", linetype = 2)
bbb <- read.csv(file = paste0(light.dir[22], "\\deck1_0990424.csv"), header = F)
#bbb <- read.csv(file = paste0(light.dir[21], "\\deck1_1190403.csv"), header = F)
head(bbb)
names(bbb) <- c("date", "time", "cdepth", "temp", "clight")
bbb$datetime <- paste(bbb$date, bbb$time)
bbb$datetime <- as.POSIXct(bbb$datetime, format = "%m/%d/%Y %H:%M:%S", tz = "America/Anchorage")
ggplot(data = bbb, aes(x = datetime, y = clight)) + geom_path()
# Using astrocalc4r, I find the sunrise time for the latitude and longitude for the first haul of every day.
ccc <- subset(haul_time_position, vessel == 94 & cruise == 201401)
#ccc <- subset(haul_time_position, vessel == 162 & cruise == 201401)
ccc <- subset(ccc, haul %in% aggregate(haul ~ yday(ccc$start_time), data = ccc, FUN = min)[,2])
ccc <- cbind(ccc,
astrocalc4r(day = day(ccc$start_time),
month = month(ccc$start_time),
year = year(ccc$start_time),
hour = hour(ccc$start_time) + minute(ccc$start_time)/60,
timezone = rep(-8, nrow(ccc)),
lat = ccc$start_latitude,
lon = ccc$start_longitude,
seaorland = "maritime"))
ccc$sunrise2 <- as.POSIXct(paste(date(ccc$start_time), " ", floor(ccc$sunrise), ":", floor(ccc$sunrise%%1 * 60), ":", floor((ccc$sunrise%%1 * 60)%%1*60), sep = ""), tz = "America/Anchorage")
ggplot() + geom_path(data = subset(bbb, month(datetime) < 7), aes(x = datetime - 3600, y = clight)) +
geom_vline(data = subset(ccc, month(sunrise2) < 7), aes(xintercept = sunrise2), col = "red", linetype = 2)
dir(light.dir[23])
light.dir
dir(light.dir[23])
dir(light.dir[24])
light.dir
dir(light.dir[21])
light.dir
dir(light.dir[24])
light.dir
light.dir[24]
light.dir[21]
light.dir[23]
dir(light.dir[23])
dir(light.dir[24])
bbb <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
ccc <- subset(haul_time_position, vessel == 94 & cruise == 201501)
names(bbb) <- c("date", "time", "cdepth", "temp", "clight")
bbb$datetime <- paste(bbb$date, bbb$time)
bbb$datetime <- as.POSIXct(bbb$datetime, format = "%m/%d/%Y %H:%M:%S", tz = "America/Anchorage")
#ccc <- subset(haul_time_position, vessel == 162 & cruise == 201401)
ccc <- subset(ccc, haul %in% aggregate(haul ~ yday(ccc$start_time), data = ccc, FUN = min)[,2])
ccc <- cbind(ccc,
astrocalc4r(day = day(ccc$start_time),
month = month(ccc$start_time),
year = year(ccc$start_time),
hour = hour(ccc$start_time) + minute(ccc$start_time)/60,
timezone = rep(-8, nrow(ccc)),
lat = ccc$start_latitude,
lon = ccc$start_longitude,
seaorland = "maritime"))
ccc$sunrise2 <- as.POSIXct(paste(date(ccc$start_time), " ", floor(ccc$sunrise), ":", floor(ccc$sunrise%%1 * 60), ":", floor((ccc$sunrise%%1 * 60)%%1*60), sep = ""), tz = "America/Anchorage")
ggplot() + geom_path(data = bbb, aes(x = datetime, y = clight)) +
geom_vline(data = ccc, aes(xintercept = sunrise2), col = "red", linetype = 2)
bb1 <- read.csv(file = paste0(light.dir[23], "\\deck1_1190403.csv"), header = F)
bb2 <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
bb1 <- read.csv(file = paste0(light.dir[23], "\\deck1_1190403.csv"), header = F)
names(bb1) <- c("date", "time", "cdepth", "temp", "clight")
bb2 <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
names(bb2) <- c("date", "time", "cdepth", "temp", "clight")
source('C:/Users/seanr/OneDrive/afsc/Light data processing/TLUtilities/test.R', echo=TRUE)
light.dir[24]
library(trawllight)
library(ggplot2)
library(plyr)
library(dplyr)
library(fishmethods)
library(TLUtilities)
# source TLUtilities functions for testing
sapply(paste("./R/", dir("./R/"), sep = ""), source)
# Import csv file containing filepaths for light data DIRECTORIES. Each target directories should contain corr_Mk9Hauls.csv, deck1**.csv, and CastTimes.csv for a vessel/cruise combination. This list needs to be created by the user.
light.dir <- read.csv("D:/Projects/OneDrive/Thesis/Chapter 1 - Visual Foraging Condition in the Eastern Bering Sea/data/fileinv_lightdata_directory.csv", stringsAsFactors = F, header = F)
# Only use EBS shelf directories.
light.dir <- light.dir[which(grepl("ebs", light.dir[,1])),1]
# Import csv file containing filepaths for light data DIRECTORIES. Each target directories should contain corr_Mk9Hauls.csv, deck1**.csv, and CastTimes.csv for a vessel/cruise combination. This list needs to be created by the user.
light.dir <- read.csv("../testing_space/imports/directories.csv", header = F, stringsAsFactors = F)
# Only use EBS shelf directories.
light.dir <- light.dir[which(grepl("ebs", light.dir[,1])),1]
# Let's examine what this does
print(head(light.dir))
haul_time_position <- readRDS("../testing_space/data/haul_time_position.rds")
bb1 <- read.csv(file = paste0(light.dir[23], "\\deck1_1190403.csv"), header = F)
names(bb1) <- c("date", "time", "cdepth", "temp", "clight")
light.dir[23]
bb1 <- read.csv(file = paste0(light.dir[23], "\\deck1_1190403.csv"), header = F)
names(bb1) <- c("date", "time", "cdepth", "temp", "clight")
bb1$vessel < "v162"
bb2 <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
names(bb2) <- c("date", "time", "cdepth", "temp", "clight")
bb2$vessel <- "v94"
rm(bb1, bb2)
timeMismatch <- function() {
bb1 <- read.csv(file = paste0(light.dir[23], "\\deck1_1190403.csv"), header = F)
names(bb1) <- c("date", "time", "cdepth", "temp", "clight")
bb1$vessel < "v162"
bb2 <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
names(bb2) <- c("date", "time", "cdepth", "temp", "clight")
bb2$vessel <- "v94"
bb <- rbind(bb1, bb2)
bb$datetime <- paste(bb$date, bb$time)
bb$datetime <- as.POSIXct(bb$datetime, format = "%m/%d/%Y %H:%M:%S", tz = "America/Anchorage")
print(ggplot() + geom_path(data = bb, aes(x = datetime, y = clight, color = vessel)))
}
timeMismatch()
timeMismatch <- function() {
bb1 <- read.csv(file = paste0(light.dir[23], "\\deck1_1190403.csv"), header = F)
names(bb1) <- c("date", "time", "cdepth", "temp", "clight")
bb1$vessel < "v162"
bb2 <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
names(bb2) <- c("date", "time", "cdepth", "temp", "clight")
bb2$vessel <- "v94"
print(ncol(bb1))
print(ncol(bb2))
bb <- rbind(bb1, bb2)
bb$datetime <- paste(bb$date, bb$time)
bb$datetime <- as.POSIXct(bb$datetime, format = "%m/%d/%Y %H:%M:%S", tz = "America/Anchorage")
print(ggplot() + geom_path(data = bb, aes(x = datetime, y = clight, color = vessel)))
}
timeMismatch()
bb2 <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
print(head(bb2))
bb1 <- read.csv(file = paste0(light.dir[23], "\\deck1_1190403.csv"), header = F)
print(head(bb1))
bb <- rbind(bb1, bb2)
timeMismatch <- function() {
bb1 <- read.csv(file = paste0(light.dir[23], "\\deck1_1190403.csv"), header = F)
names(bb1) <- c("date", "time", "cdepth", "temp", "clight")
bb1$vessel < "v162"
bb2 <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
names(bb2) <- c("date", "time", "cdepth", "temp", "clight")
bb2$vessel <- "v94"
bb <- rbind(bb1, bb2)
bb$datetime <- paste(bb$date, bb$time)
bb$datetime <- as.POSIXct(bb$datetime, format = "%m/%d/%Y %H:%M:%S", tz = "America/Anchorage")
print(ggplot() + geom_path(data = bb, aes(x = datetime, y = clight, color = vessel)))
}
timeMismatch()
ggplot() + geom_path(data = bb, aes(x = datetime, y = clight, color = vessel))
bb1 <- read.csv(file = paste0(light.dir[23], "\\deck1_1190403.csv"), header = F)
names(bb1) <- c("date", "time", "cdepth", "temp", "clight")
bb1$vessel < "v162"
bb2 <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
names(bb2) <- c("date", "time", "cdepth", "temp", "clight")
rm(bb1, bb2)
timeMismatch <- function() {
bb1 <- read.csv(file = paste0(light.dir[23], "\\deck1_1190403.csv"), header = F)
names(bb1) <- c("date", "time", "cdepth", "temp", "clight")
bb1$vessel <- "v162"
bb2 <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
names(bb2) <- c("date", "time", "cdepth", "temp", "clight")
bb2$vessel <- "v94"
bb <- rbind(bb1, bb2)
bb$datetime <- paste(bb$date, bb$time)
bb$datetime <- as.POSIXct(bb$datetime, format = "%m/%d/%Y %H:%M:%S", tz = "America/Anchorage")
print(ggplot() + geom_path(data = bb, aes(x = datetime, y = clight, color = vessel)))
}
timeMismatch()
timeMismatch <- function() {
bb1 <- read.csv(file = paste0(light.dir[23], "\\deck1_1190403.csv"), header = F)
names(bb1) <- c("date", "time", "cdepth", "temp", "clight")
bb1$vessel <- "v162"
bb2 <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
names(bb2) <- c("date", "time", "cdepth", "temp", "clight")
bb2$vessel <- "v94"
bb <- rbind(bb1, bb2)
bb$datetime <- paste(bb$date, bb$time)
bb$datetime <- as.POSIXct(bb$datetime, format = "%m/%d/%Y %H:%M:%S", tz = "America/Anchorage")
print(ggplot() + geom_path(data = subset(bb, month(datetime) < 6 & day(datetime) < 15), aes(x = datetime, y = clight, color = vessel)))
}
timeMismatch()
timeMismatch <- function() {
bb1 <- read.csv(file = paste0(light.dir[23], "\\deck1_1190403.csv"), header = F)
names(bb1) <- c("date", "time", "cdepth", "temp", "clight")
bb1$vessel <- "v162"
bb2 <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
names(bb2) <- c("date", "time", "cdepth", "temp", "clight")
bb2$vessel <- "v94"
bb <- rbind(bb1, bb2)
bb$datetime <- paste(bb$date, bb$time)
bb$datetime <- as.POSIXct(bb$datetime, format = "%m/%d/%Y %H:%M:%S", tz = "America/Anchorage")
print(ggplot() + geom_path(data = subset(bb, month(datetime) < 7 & day(datetime) < 15), aes(x = datetime, y = clight, color = vessel)))
}
timeMismatch()
timeMismatch <- function() {
bb1 <- read.csv(file = paste0(light.dir[23], "\\deck1_1190403.csv"), header = F)
names(bb1) <- c("date", "time", "cdepth", "temp", "clight")
bb1$vessel <- "v162"
bb2 <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
names(bb2) <- c("date", "time", "cdepth", "temp", "clight")
bb2$vessel <- "v94"
bb <- rbind(bb1, bb2)
bb$datetime <- paste(bb$date, bb$time)
bb$datetime <- as.POSIXct(bb$datetime, format = "%m/%d/%Y %H:%M:%S", tz = "America/Anchorage")
print(ggplot() + geom_path(data = subset(bb, month(datetime) >= 7 & day(datetime) > 15), aes(x = datetime, y = clight, color = vessel)))
}
timeMismatch()
timeMismatch <- function() {
bb1 <- read.csv(file = paste0(light.dir[23], "\\deck1_1190403.csv"), header = F)
names(bb1) <- c("date", "time", "cdepth", "temp", "clight")
bb1$vessel <- "v162"
bb2 <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
names(bb2) <- c("date", "time", "cdepth", "temp", "clight")
bb2$vessel <- "v94"
bb <- rbind(bb1, bb2)
bb$datetime <- paste(bb$date, bb$time)
bb$datetime <- as.POSIXct(bb$datetime, format = "%m/%d/%Y %H:%M:%S", tz = "America/Anchorage")
bb$datetime[bb$vessel == "v94"] <- bb$datetime[bb$vessel == "v94"] - 3600
print(ggplot() + geom_path(data = subset(bb, month(datetime) >= 7 & day(datetime) > 15), aes(x = datetime, y = clight, color = vessel)))
}
timeMismatch()
library(TLUtilities)
getwd()
setwd("../testing_space/")
getwd()
knitr::opts_chunk$set(echo = TRUE)
library(trawllight)
library(TLUtilities)
light.dir <- read.csv("./imports/directories.csv", stringsAsFactors = F, header = F)
# Select EBS shelf directories
light.dir <- light.dir[which(grepl("ebs", light.dir[,1])),1]
light.dir[1:3]
ebs <- process_all(dir.structure = light.dir[10:12],
cast.dir = "Downcast",
time.buffer = 20,
silent = T)
names(ebs)
head(ebs$loess_eval)
head(ebs$resid_fit)
head(ebs$atten_values)
head(ebs$light_ratios)
ebs_surface <- process_all_surface(dir.structure = light.dir[c(1, 5, 10:15)], adjust.time = F, time.buffer = 30, agg.fun = geometric.mean)
head(ebs_surface)
table(ebs_surface$updown, ebs_surface$cruise)
haul.dat <- readRDS("./data/haul_time_position.rds")
str(haul.dat)
ebs_surface.haul <- merge(ebs_surface, haul.dat)
ebs_surface.haul <- subset(ebs_surface.haul, updown == "Downcast")
library(fishmethods)
library(lubridate)
ebs_surface.haul <- cbind(ebs_surface.haul,
astrocalc4r(day = day(ebs_surface.haul$start_time),
month = month(ebs_surface.haul$start_time),
year = year(ebs_surface.haul$start_time),
hour = hour(ebs_surface.haul$start_time) + minute(ebs_surface.haul$start_time)/60,
timezone = rep(-8, nrow(ebs_surface.haul)),
lat = ebs_surface.haul$start_latitude,
lon = ebs_surface.haul$start_longitude))
head(ebs_surface.haul)
library(ggplot2)
ggplot(data = ebs_surface.haul) +
geom_point(aes(x = log10(PAR + 0.001), y = log10(surf_trans_llight), color = paste(vessel, cruise, sep = "/"))) +
geom_smooth(aes(x = log10(PAR + 0.001), y = log10(surf_trans_llight))) +
scale_color_discrete(name = "Vessel/Cruise")
ebs_surface <- process_all_surface(dir.structure = light.dir[c(1, 5, 10:15)], adjust.time = T, time.buffer = 30)
ebs_surface.haul <- subset(merge(ebs_surface, haul.dat), updown == "Downcast")
ebs_surface.haul <- cbind(ebs_surface.haul,
astrocalc4r(day = day(ebs_surface.haul$start_time),
month = month(ebs_surface.haul$start_time),
year = year(ebs_surface.haul$start_time),
hour = hour(ebs_surface.haul$start_time) + minute(ebs_surface.haul$start_time)/60,
timezone = rep(-8, nrow(ebs_surface.haul)),
lat = ebs_surface.haul$start_latitude,
lon = ebs_surface.haul$start_longitude,
seaorland = "maritime"))
ggplot(data = ebs_surface.haul) +
geom_point(aes(x = log10(PAR + 0.001), y = log10(surf_trans_llight), color = paste(vessel, cruise, sep = "/"))) +
geom_smooth(aes(x = log10(PAR + 0.001), y = log10(surf_trans_llight))) +
scale_color_discrete(name = "Vessel/Cruise")
library(TLUtilities)
library(trawllight)
View(tag_residuals_indirect)
getwd()
library(TLUtilities)
library(TLUtilities)
library(TLUtilities)
bb1 <- read.csv(file = paste0(light.dir[23], "\\deck1_1190403.csv"), header = F)
names(bb1) <- c("date", "time", "cdepth", "temp", "clight")
bb1$vessel <- "v162"
bbb <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
ccc <- subset(haul_time_position, vessel == 94 & cruise == 201501)
names(bbb) <- c("date", "time", "cdepth", "temp", "clight")
bbb$datetime <- paste(bbb$date, bbb$time)
bbb$datetime <- as.POSIXct(bbb$datetime, format = "%m/%d/%Y %H:%M:%S", tz = "America/Anchorage")
# AKK
require(lubridate)
### Messing with timestamps
test <- bbb$datetime[1]
source('C:/Users/seanr/OneDrive/afsc/Light data processing/TLUtilities/test.R', echo=TRUE)
test
# AKK
require(lubridate)
bbb <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
ccc <- subset(haul_time_position, vessel == 94 & cruise == 201501)
names(bbb) <- c("date", "time", "cdepth", "temp", "clight")
bbb$datetime <- paste(bbb$date, bbb$time)
bbb$datetime <- as.POSIXct(bbb$datetime, format = "%m/%d/%Y %H:%M:%S", tz = "America/Anchorage")
library(trawllight)
library(ggplot2)
library(plyr)
library(dplyr)
library(fishmethods)
library(TLUtilities)
# source TLUtilities functions for testing
sapply(paste("./R/", dir("./R/"), sep = ""), source)
# Import csv file containing filepaths for light data DIRECTORIES. Each target directories should contain corr_Mk9Hauls.csv, deck1**.csv, and CastTimes.csv for a vessel/cruise combination. This list needs to be created by the user.
light.dir <- read.csv("../testing_space/imports/directories.csv", header = F, stringsAsFactors = F)
# Only use EBS shelf directories.
light.dir <- light.dir[which(grepl("ebs", light.dir[,1])),1]
# Let's examine what this does
print(head(light.dir))
bbb <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
ccc <- subset(haul_time_position, vessel == 94 & cruise == 201501)
names(bbb) <- c("date", "time", "cdepth", "temp", "clight")
bbb$datetime <- paste(bbb$date, bbb$time)
bbb$datetime <- as.POSIXct(bbb$datetime, format = "%m/%d/%Y %H:%M:%S", tz = "America/Anchorage")
ggplot(data = bbb, aes(x = datetime, y = clight)) + geom_path()
### Messing with timestamps
test <- bbb$datetime[1]
### Messing with timestamps
test <- bbb$datetime[1]
test
tz(test)
with_tz("America/Los Angeles")
with_tz("America/Pacific")
with_tz("America/Seattle")
?with_tz
with_tz(test, "America/Los Angeles")
with_tz(test, "America/Los_Angeles")
test
with_tz(test, "America/Los_Angeles")
test2 <- with_tz(test, "America/Los_Angeles")
force_tz(test2, "America/Anchorage")
force_tz(test, "America/Los_Angeles")
force_tz(test, "America/Los_Angeles")
test
bbb$datetime[1]
timeMismatch()
timeMismatch <- function() {
bb1 <- read.csv(file = paste0(light.dir[23], "\\deck1_1190403.csv"), header = F)
names(bb1) <- c("date", "time", "cdepth", "temp", "clight")
bb1$vessel <- "v162"
bb2 <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
names(bb2) <- c("date", "time", "cdepth", "temp", "clight")
bb2$vessel <- "v94"
bb <- rbind(bb1, bb2)
bb$datetime <- paste(bb$date, bb$time)
bb$datetime <- as.POSIXct(bb$datetime, format = "%m/%d/%Y %H:%M:%S", tz = "America/Anchorage")
bb$datetime[bb$vessel == "v94"] <- bb$datetime[bb$vessel == "v94"] - 3600
print(ggplot() + geom_path(data = subset(bb, month(datetime) >= 7 & day(datetime) > 15), aes(x = datetime, y = clight, color = vessel)))
}
timeMismatch()
timeMismatch <- function() {
bb1 <- read.csv(file = paste0(light.dir[23], "\\deck1_1190403.csv"), header = F)
names(bb1) <- c("date", "time", "cdepth", "temp", "clight")
bb1$vessel <- "v162"
bb2 <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
names(bb2) <- c("date", "time", "cdepth", "temp", "clight")
bb2$vessel <- "v94"
bb <- rbind(bb1, bb2)
bb$datetime <- paste(bb$date, bb$time)
bb$datetime <- as.POSIXct(bb$datetime, format = "%m/%d/%Y %H:%M:%S", tz = "America/Anchorage")
bb$datetime[bb$vessel == "v94"] <- bb$datetime[bb$vessel == "v94"]
print(ggplot() + geom_path(data = subset(bb, month(datetime) >= 7 & day(datetime) > 15), aes(x = datetime, y = clight, color = vessel)))
}
timeMismatch()
timeMismatch <- function() {
bb1 <- read.csv(file = paste0(light.dir[23], "\\deck1_1190403.csv"), header = F)
names(bb1) <- c("date", "time", "cdepth", "temp", "clight")
bb1$vessel <- "v162"
bb2 <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
names(bb2) <- c("date", "time", "cdepth", "temp", "clight")
bb2$vessel <- "v94"
bb <- rbind(bb1, bb2)
bb$datetime <- paste(bb$date, bb$time)
bb$datetime <- as.POSIXct(bb$datetime, format = "%m/%d/%Y %H:%M:%S", tz = "America/Anchorage")
bb$datetime[bb$vessel == "v94"] <- bb$datetime[bb$vessel == "v94"]
print(ggplot() + geom_path(data = subset(bb, month(datetime) >= 7 & day(datetime) > 25), aes(x = datetime, y = clight, color = vessel)))
}
timeMismatch()
### Messing with timestamps
test <- bbb$datetime[1]
test
force_tz(test, "America/Los_Angeles")
with_tz(test, "America/Los_Angeles")
test2 <- with_tz(test, "America/Los_Angeles")
force_tz(test2, "America/Anchorage")
test2 <- force_tz(test, "America/Los_Angeles")
with_tz(test2, "America/Anchorage")
### Messing with timestamps
test <- bbb$datetime[1] - 3600
test
timeMismatch <- function() {
bb1 <- read.csv(file = paste0(light.dir[23], "\\deck1_1190403.csv"), header = F)
names(bb1) <- c("date", "time", "cdepth", "temp", "clight")
bb1$vessel <- "v162"
bb2 <- read.csv(file = paste0(light.dir[24], "\\deck1_0990424.csv"), header = F)
names(bb2) <- c("date", "time", "cdepth", "temp", "clight")
bb2$vessel <- "v94"
bb <- rbind(bb1, bb2)
bb$datetime <- paste(bb$date, bb$time)
bb$datetime <- as.POSIXct(bb$datetime, format = "%m/%d/%Y %H:%M:%S", tz = "America/Anchorage")
bb$datetime[bb$vessel == "v94"] <- with_tz(force_tz(bb$datetime[bb$vessel == "v94"], "America/Los_Angeles"), "America/Anchorage")
print(ggplot() + geom_path(data = subset(bb, month(datetime) >= 7 & day(datetime) > 25), aes(x = datetime, y = clight, color = vessel)))
}
timeMismatch()
### Messing with timestamps
test <- bbb$datetime[1] - 3600
bbb$datetime[1]
### Messing with timestamps
test <- bbb$datetime[1]
bbb$datetime[1]
force_tz(test, "America/Los_Angeles")
test <- bbb$datetime[1]
force_tz(test, "America/Los_Angeles")
library(TLUtilities)
